
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"content="width-device-width,initial-scale-1.0">
  <meta http-equiv="X-UA-Compatible"content="ie-edge">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js" integrity="sha512-9mpsATI0KClwt+xVZfbcf2lJ8IFBAwsubJ6mI3rtULwyM3fBmQFzj0It4tGqxLOGQwGfJdk/G+fANnxfq9/cew==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <link rel="stylesheet" href="style.css">
  <title>Chat da Baguncinha</title>
  
</head>
<body>
 
  <div class="container">
    <div class="header">
      <div class="grp-info">
        <h3 class="grp-name">
          Bate Papo 
        </h3>
      </div>
    </div>
  
    <div class="chatbox messages">
      <div class="chat">
        <img src="https://i.ytimg.com/vi/e-J3hzc8kN8/mqdefault.jpg" alt="">
        <p class="msg">
          <strong style="font-size:16px">Leonardo</strong><br><br>

          <ion-icon name="caret-back-outline"></ion-icon>
            Solta o Verbo ðŸ˜Š
        </p>
      </div>
  </div>

  <div class="container">
    <div class="footer">
      <div class="grp-info"  style="width: 100%;">
        <form id="chat" style="width: 100%;">
          <!-- <input type="text"name="username"placeholder="Digite seu usuÃ¡rio"> -->
          <div class="messages"></div>
          <textarea type="text"name="message"placeholder="Digite sua mensagem" style="background:none; border:none; color:white; width:70%; height: 90%; box-shadow: 0 0 0 0; outline: 0; resize: none; border-radius: 5px;"></textarea>
          <button type="submit" style="float:right; margin-top:10px; height: 30px; background: white; color:#4E1094; border:none; border-radius: 5px; width:90px; cursor:pointer;">Enviar</button>
        </form>
      </div>
    </div>

  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  <!-- <form id="chat">
    <input type="text"name="username"placeholder="Digite seu usuÃ¡rio">
    <div class="messages"></div>
    <input type="text"name="message"placeholder="Digite sua mensagem">
    <button type="submit">Enviar</button>

  </form> -->
  <script type="text/javascript">
    // var socket = io('http://localhost:4000');
    var socket = io('/');
    
    if(!localStorage.getItem('nome')){
      let name = prompt('Digite seu Nome');
      localStorage.setItem('nome', name)
    }
    
    function renderMEssage(message){
      // $('.messages').append(`<div class="message"><strong>${message.author}: <strong/>${message.message}</div>`)
      $('.messages').append(`  
      <div class="chat">
        <img src="https://i.ytimg.com/vi/e-J3hzc8kN8/mqdefault.jpg" alt="">
        <p class="msg">
          <strong style="font-size:16px">${message.author}</strong><br><br>

          <ion-icon name="caret-back-outline"></ion-icon>
          ${message.message}
        </p>
      </div>`)

      
    }

    socket.on('receivedMessage', function(message){
      renderMEssage(message)
    })

    socket.on('previusMessages', function(message){
      for(message of message){
        renderMEssage(message)

      }
    })


    $('#chat').submit( function(event) {
      event.preventDefault();

      var author = localStorage.getItem('nome');
      var message = $('input[name=message]').val();

      if(author.length && message.length){
          var messageObject = {
          author:author,
          message:message
        };
        socket.emit('sendMessage', messageObject);
        renderMEssage(messageObject)
        socket.emit('login',{userId:author});


      }
      
    })
  </script>
</body>
</html>